# Проект transaction_analysis_app

Приложение **transaction_analysis_app** предназначено для анализа финансовых 
операций и создания различных отчетов на основе транзакций пользователей. 
Приложение включает в себя несколько модулей и сервисов, каждый из которых 
решает определённые задачи. 

Данное Python-приложение считывает данные о транзакциях из файла Excel, 
выполняет вычисления, генерирует отчеты и взаимодействует с внешними API 
для получения курсов валют и цен акций.


## Функциональные возможности

- Импорт данных о транзакциях: *Считывает данные о транзакциях из файла Excel* 
(`transactions_excel.xlsx`).
- Обработка данных: *Очищает, преобразует и фильтрует данные о транзакциях.*
- Генерация отчетов: *Генерирует отчеты, такие как:*
    * Расходы по рабочим дням (средние расходы в рабочие и выходные дни).
- Интеграция с внешними API:
    * Получает курсы валют с https://api.apilayer.com/.
    * Получает цены акций с https://site.financialmodelingprep.com/.
- Настраиваемые параметры: *Параметры пользователя хранятся в файле* 
`user_settings.json`.
- Логирование: *Детальное логирование событий приложения ведется в директории* `log`.
- Тестирование: *Включены всесторонние модульные тесты с использованием pytest.*


## Структура проекта

```
transaction_analysis_app
│   .venv
│   .coverage
│   .flake8
│   .gitignore
│   env.example
│   main.py
│   poetry.lock
│   pyproject.toml
│   README.md
│   user_settings.json
│
├───data
│       operations.xlsx
│
├───htmlcov
│
├───log
│       __init__.py
│
└───src
    │   __init__.py
    │   external_api.py
    │   reports.py
    │   services.py
    │   utils.py
    │   views.py
│
└───tests
    │   __init__.py
    │   conftest.py
    │   test_external_api.py
    │   test_reports.py
    │   test_services.py
    │   test_utils.py
    │   test_views.py
```

### Основные компоненты приложения:

#### `src` — Модули приложения:

- `external_api.py`: Работа с внешними API для получения курсов валют и стоимости акций.
- `reports.py`: Генерация отчётов на основе данных транзакций.
- `services.py`: Реализация бизнес-логики, включая расчёт накоплений через сервис "Инвесткопилка".
- `utils.py`: Вспомогательные утилиты для работы с файлами, декораторы и функции для обработки данных.
- `views.py`: Логика представления данных пользователям, например, формирование веб-страниц.

#### `tests` — Тестовые файлы:

Тестовый модуль содержит юнит-тесты для всех основных компонентов приложения:

- `conftest.py` содержит фикстуры для тестов;
- `test_external_api.py` - тесты для модуля `external_api.py`; 
- `test_utils.py` - тесты для модуля `utils.py`;
- `test_reports.py` - тесты для модуля `reports.py`;
- `test_views.py` - тесты для модуля `views.py`;
- `test_services.py` - тесты для модуля `services.py`.

#### `log` — Файлы логирования:

Хранит лог-файлы приложения, такие как `mylog_reports.log`.

#### `data` — Исходные данные:

Файл `operations.xlsx` используется для хранения исходных данных о транзакциях.

---

## Основные функции модуля `utils.py`

Модуль `utils.py` содержит следующие ключевые функции:

- **path_file()**: Получение абсолютного пути к файлу.
- **configure_logging()**: Настройка логирования с указанием путей к файлам и нужной кодировки.
- **get_decorator()**: Декоратор для записи отчетов о выполнении функций.
- **get_read_excel()**: Чтение Excel файла и преобразование его в pandas DataFrame.
- **get_required_columns()**: Выборка необходимых столбцов из DataFrame.
- **get_formatted_date()**: Форматирование столбца с датами.
- **get_list_dict_transactions()**: Преобразование DataFrame в список словарей.
- **get_to_json_investment_savings()**: Генерация JSON-ответа для сервиса "Инвесткопилка".
- **update_user_settings()**: Обновление настроек пользователя в файле `user_settings.json`.
- **get_choice_data()**: Выбор данных за указанный временной интервал.
- **get_to_json_views()**: Преобразование данных для отображения на странице "События" в JSON формат.

---

## Внешние зависимости

Для работы приложения используются внешние API:

- **Курс валют**: https://api.apilayer.com/.
- **Стоимость акций**: https://site.financialmodelingprep.com/.

Эти сервисы интегрированы в приложение для предоставления актуальных данных.

---

## Установка

1. Клонируйте репозиторий:
```
git clone git@github.com:Nefertitu/transaction_analysis_app.git
```
2. Установите зависимости:
```
poetry install
```

## Запуск приложения

Запустите проект с помощью файла `main.py`. Этот скрипт является точкой входа 
и связывает функциональность разных модулей между собой.

```bash
python main.py
```

Для настройки окружения рекомендуется использовать виртуальное окружение 
и менеджер зависимостей `poetry`.

---

## Тестирование

Проект включает юнит-тесты pytest.

Для запуска тестов выполните команду:
- при активированном виртуальном окружении:
```
pytest --cov
 
```
- через poetry:
```
poetry run pytest --cov
```
*Текущие результаты тестирования:*
```
---------- coverage: platform win32, python 3.13.1-final-0 -----------
Name                         Stmts   Miss  Cover
------------------------------------------------
src\__init__.py                  0      0   100%
src\external_api.py             46      3    93%
src\reports.py                  30      0   100%
src\services.py                 12      1    92%
src\utils.py                   117     20    83%
src\views.py                    52      3    94%
tests\__init__.py                0      0   100%
tests\conftest.py              125     18    86%
tests\test_external_api.py      75      3    96%
tests\test_reports.py           10      0   100%
tests\test_services.py           6      0   100%
tests\test_utils.py            102      0   100%
tests\test_views.py             36      0   100%
------------------------------------------------
TOTAL                          611     48    92%


====================== 32 passed in 1.18s ===========================

```

## Примеры работы основных функций:

1. Пример работы функционала "Страница 'События'":
```
=====СТРАНИЦА_'СОБЫТИЯ'=====

Привет! Добро пожаловать в программу работы с банковскими транзакциями!

Приветствуем на странице 'События'!

Желаете получить информацию о доходах/расходах? (Да/Нет): да

Введите дату, по состоянию на которую требуются данные,
и период, который следует отобразить в отчете.

Дата (в формате ГГГГ-ММ-ДД): 2020-06-01

Отчетный период ('неделя', 'месяц', 'год', 'все данные'): месяц

Желаете получить информацию о текущем курсе валют? (Да/Нет): да

Введите код валюты для получения текущего курса (USD, EUR и т.д.): да

Введите код валюты (USD, EUR и т.д.): USD, EUR 

Желаете получить информацию о текущей стоимости акций? (Да/Нет): да

Введите тикеры(названия) интересующих акций 
(AAPL, AMZN, GOOGL, MSFT, TSLA и др.): AAPL, AMZN, GOOGL, MSFT, TSLA


Данные успешно переданы.

Распечатываю итоговые данные...


{
  "expenses": {
    "total_amount": 123.7,
    "main": [
      [
        {
          "category": "Остальное",
          "amount": 123.7
        }
      ]
    ],
    "transfers_and_cash": [
      {
        "category": "Наличные",
        "amount": 0.0
      },
      {
        "category": "Переводы",
        "amount": 0.0
      }
    ]
  },
  "income": {
    "total_amount": 343.39,
    "main": [
      {
        "category": "Пополнения",
        "amount": 343.39
      }
    ]
  },
  "currency_rates": [
    {
      "currency": "USD",
      "rate": 86.79
    },
    {
      "currency": "EUR",
      "rate": 90.47
    }
  ],
  "stock_prices": [
    {
      "stock": "AAPL",
      "price": 241.09
    },
    {
      "stock": "AMZN",
      "price": 214.41
    },
    {
      "stock": "GOOGL",
      "price": 170.97
    },
    {
      "stock": "MSFT",
      "price": 399.37
    },
    {
      "stock": "TSLA",
      "price": 290.23
    }
  ]
}


Для продолжения работы приложения нажмите `Enter`__

```

2. Пример работы сервиса "Инвесткопилка":
```
=====ИНВЕСТКОПИЛКА=====

Представляем Вашему вниманию сервис 'Инвесткопилка'.

Желаете узнать сумму возможных накоплений? (Введите: Да/Нет): да

Определите месяц для которого будет рассчитана отложенная сумма
(введите дату в формате 'ГГГГ-ММ'): 2021-12

Введите лимит округления - 10, 50 или 100 (рублей): 100

Распечатываю итоговые данные...


    {
        "Сумма инвестиционных накоплений":"11027.69",
        "Период для расчета накоплений":"2021-12",
        "Лимит округления":100
    }


Для продолжения работы приложения нажмите `Enter`__

```

2. Пример работы сервиса "Траты в рабочий и выходной день":
```
=====ТРАТЫ_В_РАБОЧИЙ_И_ВЫХОДНОЙ_ДЕНЬ=====

Представляем вашему вниманию сервис 'Траты в рабочий/входной день'.

Желаете узнать среднюю сумму трат в рабочий или в выходной день?
Расчет производится за последние 3 месяца от отчетной даты.
(Введите: Да/Нет): да

Желаете установить в качестве отчетной текущую дату? [ne sovetuju ))]
(Введите: Да/Нет): нет

Введите дату отсчета трехмесячного периода в формате 'ГГГГ-ММ-ДД': 2020-12-03

Распечатываю итоговые данные...

    {
        "Средние траты в рабочий день":2287.56,
        "Средние траты в выходной день":828.64
    }



Завершение работы приложения.
```

## Лицензия

Проект распространяется под лицензией MIT License. Подробная информация доступна 
в файле LICENSE.txt [лицензия MIT](LICENSE.txt).

